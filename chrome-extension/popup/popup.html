<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Time Tracker</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <!-- Login View (shown when not authenticated) -->
  <div id="login-view" class="view hidden">
    <div class="logo">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10" stroke-width="2"/>
        <polyline points="12 6 12 12 16 14" stroke-width="2"/>
      </svg>
    </div>
    <h2>Login Required</h2>
    <p class="subtitle">Connect to your portal account to track time.</p>

    <div class="auth-form">
      <div class="form-group">
        <label for="token-input">Extension Token</label>
        <input type="password" id="token-input" placeholder="Paste your extension token here" autocomplete="off">
        <span class="help-text">Get your token from the portal</span>
      </div>
      <button id="save-token-btn" class="btn btn-primary" disabled>
        <span class="btn-text">Save Token</span>
        <span class="btn-loader hidden">‚è≥</span>
      </button>
      <button id="login-btn" class="btn btn-secondary">
        Open Portal to Get Token
      </button>
    </div>
  </div>

  <!-- Main View (shown when authenticated) -->
  <div id="main-view" class="view hidden">
    <!-- Header -->
    <header class="header">
      <div class="user-info">
        <div class="user-avatar">üë§</div>
        <div class="user-details">
          <span id="user-name" class="user-name">Loading...</span>
          <span id="user-org" class="user-org">...</span>
        </div>
      </div>
      <button id="settings-btn" class="btn-icon" title="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v6m0 6v10m8.66-13.76l-5.2 3m-2.92 1.68l-5.2 3M20.66 19.36l-5.2-3m-2.92-1.68l-5.2-3"/>
        </svg>
      </button>
    </header>

    <!-- Settings Menu (hidden by default) -->
    <div id="settings-menu" class="settings-menu hidden">
      <div class="settings-menu-item">
        <span>Theme</span>
      </div>
      <div class="theme-options">
        <button class="theme-option" data-theme="light">Light</button>
        <button class="theme-option" data-theme="dark">Dark</button>
        <button class="theme-option active" data-theme="system">System</button>
      </div>
      <div class="section-divider"></div>
      <div class="settings-menu-item" id="logout-btn">
        <span>Logout</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
        </svg>
      </div>
    </div>

    <!-- Status Messages -->
    <div id="status-message" class="status-message hidden"></div>

    <!-- Running Timer Bar (shown when timer is running) -->
    <div id="timer-running-bar" class="timer-running-bar hidden">
      <div class="timer-indicator">
        <span class="timer-pulse"></span>
        <div class="timer-details">
          <div class="timer-service" id="timer-service-name">Loading...</div>
          <div class="timer-meta" id="timer-meta">...</div>
        </div>
      </div>
      <div class="timer-display">
        <div class="timer-time" id="timer-elapsed">00:00:00</div>
        <button id="stop-timer-btn" class="btn-stop-timer">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <rect x="6" y="6" width="12" height="12" rx="2"/>
          </svg>
          Stop
        </button>
      </div>
    </div>

    <!-- Start Timer Section (primary action) -->
    <section id="start-timer-section">
      <h3 class="section-title">Start Timer</h3>
      <form id="start-timer-form">
        <div class="form-group">
          <label for="timer-service">Service *</label>
          <select id="timer-service" required>
            <option value="">Select a service...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="timer-description">Description (Optional)</label>
          <textarea id="timer-description" rows="2" placeholder="What are you working on?"></textarea>
        </div>

        <button type="submit" id="start-timer-btn" class="btn btn-primary btn-block">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="5 3 19 12 5 21 5 3"/>
          </svg>
          <span id="start-timer-text">Start Timer</span>
          <span id="start-timer-loader" class="btn-loader hidden">‚è≥</span>
        </button>
      </form>
    </section>

    <div class="section-divider"></div>

    <!-- Manual Time Entry Section (collapsible, secondary) -->
    <section id="manual-entry-section">
      <button id="manual-entry-toggle" class="manual-entry-toggle">
        <span>Add time manually</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </button>

      <div id="manual-entry-content" class="manual-entry-content hidden">
        <form id="entry-form">
          <div class="form-group">
            <label for="service">Service *</label>
            <select id="service" required>
              <option value="">Select a service...</option>
            </select>
            <span class="error-message" id="service-error"></span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="duration">Duration (hours) *</label>
              <input type="text" id="duration" placeholder="2.5 or 2:30" required autocomplete="off">
              <span class="error-message" id="duration-error"></span>
            </div>

            <div class="form-group">
              <label for="date">Date *</label>
              <input type="date" id="date" required>
              <span class="error-message" id="date-error"></span>
            </div>
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" rows="2" placeholder="What did you work on?"></textarea>
            <span class="error-message" id="description-error"></span>
          </div>

          <button type="submit" id="submit-btn" class="btn btn-primary btn-block">
            <span id="submit-text">Log Time</span>
            <span id="submit-loader" class="btn-loader hidden">‚è≥</span>
          </button>
        </form>
      </div>
    </section>

    <!-- Recent Entries -->
    <section id="recent-entries" class="recent-entries">
      <h3 class="section-title">Recent Entries</h3>
      <div id="entries-list" class="entries-list">
        <div class="loading-skeleton">
          <div class="skeleton-entry"></div>
          <div class="skeleton-entry"></div>
          <div class="skeleton-entry"></div>
        </div>
      </div>
    </section>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator hidden">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="1" y1="1" x2="23" y2="23" stroke-width="2"/>
        <path d="M16.72 11.06A10 10 0 0 1 19 15M8 20h8M12 20v-4" stroke-width="2"/>
      </svg>
      <span>Offline - entries will be queued</span>
      <span id="queue-count" class="queue-count hidden"></span>
    </div>
  </div>

  <!-- Loading View (initial load) -->
  <div id="loading-view" class="view">
    <div class="loading-spinner">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10" stroke-width="2" stroke-dasharray="60" stroke-dashoffset="30"/>
      </svg>
      <p>Loading...</p>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../lib/config.js"></script>
  <script src="../lib/storage.js"></script>
  <script src="../lib/api-client.js"></script>
  <script src="popup.js"></script>
</body>
</html>
